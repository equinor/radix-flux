# Dependent on the secret "cloud-credentials", which should be installed by the base component script
# See https://github.com/equinor/radix-platform/scripts/velero
---
apiVersion: flux.weave.works/v1beta1
kind: HelmRelease
metadata:
  name: velero
  namespace: velero
  annotations:
    flux.weave.works/ignore: false
spec:
  releaseName: velero
  chart:
    repository: https://kubernetes-charts.storage.googleapis.com/
    name: velero
    version: 2.1.1
  values:
    updateStrategy: RollingUpdate
    configuration:
      provider: azure
      backupStorageLocation:
        name: azure
        bucket: velero
        config:
          resourceGroup: Velero_Backups
          storageAccount: radixvelerodev
      volumeSnapshotLocation:
        name: azure
        apitimeout: 300s
    credentials:
      useSecret: true
      existingSecret: cloud-credentials
